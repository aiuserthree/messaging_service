# 브랜드톡 발송 기능정의서

| Role | 1Depth | 2Depth | 3Depth | 4Depth | 타입 | 화면명 | 화면 ID | PC/MO | spec | 접근 권한 | 기능 설명 | 관련 요구사항ID | 비고 |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| 카톡발송 | 카톡발송 | 브랜드톡 발송 | 메인 페이지 | - | page | 카톡발송 > 브랜드톡 발송 | KKO_2_2_0_0_0_P | 공통 | 1차 | 로그인 | **1. 페이지 진입 시 템플릿 확인**<br>- 선택한 브랜드 채널의 템플릿 존재 여부 자동 확인<br>- 템플릿이 없는 경우 안내 영역 표시<br>  ㄴ 안내 메시지: "등록된 브랜드톡 템플릿이 없습니다"<br>  ㄴ 상세 안내: "브랜드톡 발송을 위해서는 템플릿을 먼저 등록해야 합니다"<br>  ㄴ "브랜드톡은 템플릿 등록 즉시 사용 가능합니다"<br>  ㄴ 템플릿 등록 절차 간단 안내<br>  ㄴ "템플릿 등록하러 가기" 버튼<br>  ㄴ 버튼 클릭 시 템플릿 관리 페이지로 이동<br>- 템플릿이 있는 경우 정상 발송 화면 표시<br>**2. 브랜드 채널 선택 영역**<br>- 드롭다운으로 브랜드 채널 목록 표시<br>- 채널별 활성 상태 표시<br>- 채널 변경 시 해당 채널의 템플릿 존재 여부 재확인<br>**3. 발송 설정 영역 (템플릿 있는 경우에만 활성화)**<br>- 템플릿 선택, 메시지 입력, 수신자 설정 등 모든 기능 제공 | KKO_REQ_001 | - 페이지 진입 시 템플릿 존재 여부 우선 확인<br>- 템플릿 부재 시 명확한 안내 제공<br>- 채널 전환 시 실시간 체크<br>- 브랜드톡은 승인 절차 없이 즉시 사용 |
| 카톡발송 | 카톡발송 | 브랜드톡 발송 | 템플릿 선택 | - | layer popup | 카톡발송 > 브랜드톡 발송 > 템플릿 선택 | KKO_2_2_1_0_0_LP | 공통 | 1차 | 로그인 | **1. 템플릿 선택 레이어 팝업**<br>- "템플릿 선택" 버튼 클릭 시 레이어 팝업 호출<br>- 등록된 템플릿 목록 조회<br>  ㄴ 선택한 브랜드 채널의 템플릿 표시<br>  ㄴ 최신 등록순 정렬<br>  ㄴ 카테고리별 필터링 (기본/강조/이미지/와이드/캐러셀)<br>  ㄴ 상태 필터 (활성/비활성)<br>- 템플릿 정보 표시<br>  ㄴ 템플릿 코드<br>  ㄴ 템플릿명<br>  ㄴ 템플릿 유형<br>  ㄴ 내용 미리보기 (200자 제한)<br>  ㄴ 변수 개수 표시<br>  ㄴ 버튼 개수 표시<br>  ㄴ 등록일<br>  ㄴ 사용 상태 (활성/비활성)<br>- 템플릿 검색 기능<br>  ㄴ 템플릿명, 템플릿 코드로 검색<br>- 템플릿 상세보기<br>  ㄴ 템플릿 클릭 시 전체 내용 표시<br>  ㄴ 변수 목록 및 설명<br>  ㄴ 버튼 정보<br>  ㄴ 이미지 미리보기 (이미지형의 경우)<br>- 템플릿 선택<br>  ㄴ "선택" 버튼 클릭 시 해당 템플릿 적용<br>  ㄴ 팝업 자동 닫기<br>  ㄴ 메인 페이지에 템플릿 내용 자동 입력<br>**- 템플릿 등록 안내 (템플릿이 없는 경우)**<br>  ㄴ 팝업 중앙에 안내 영역 표시<br>  ㄴ 아이콘 + 메시지: "등록된 브랜드톡 템플릿이 없습니다"<br>  ㄴ 상세 안내 텍스트:<br>    → "브랜드톡 발송을 위해서는 템플릿을 먼저 등록해야 합니다"<br>    → "브랜드톡은 템플릿 등록 즉시 사용 가능합니다"<br>    → "승인 절차 없이 바로 발송할 수 있습니다"<br>  ㄴ "템플릿 등록하러 가기" 버튼 (Primary 스타일)<br>    → 클릭 시 템플릿 관리 페이지로 이동 (새 탭)<br>    → URL: /kakao/template/brandtalk<br>  ㄴ "템플릿 등록 가이드 보기" 링크<br>    → 클릭 시 브랜드톡 템플릿 등록 가이드 페이지 열림<br>    → 템플릿 유형별 작성 가이드 제공<br>  ㄴ "닫기" 버튼<br>- 닫기 버튼<br>  ㄴ 팝업 닫기 | KKO_REQ_002 | - 템플릿 관리 페이지 연동<br>- 활성화된 템플릿만 선택 가능<br>- 템플릿 유형별 아이콘 표시<br>- 템플릿 부재 시 등록 유도<br>- 승인 절차 없음 (즉시 사용) |
| 카톡발송 | 카톡발송 | 브랜드톡 발송 | 수신자 업로드 | - | layer popup | 카톡발송 > 브랜드톡 발송 > 수신자 업로드 | KKO_2_2_2_0_0_LP | 공통 | 1차 | 로그인 | **1. 수신자 업로드 레이어 팝업**<br>- "엑셀 업로드" 버튼 클릭 시 레이어 팝업 호출<br>- 업로드 방식 안내<br>  ㄴ 일반 업로드: 전화번호만 입력<br>  ㄴ 변수 치환 업로드: 전화번호 + 변수값 입력<br>- 엑셀 샘플 다운로드<br>  ㄴ "샘플 다운로드" 버튼<br>  ㄴ 일반용 샘플: 이름, 전화번호 컬럼<br>  ㄴ 변수 치환용 샘플: 이름, 전화번호, 템플릿 변수 컬럼<br>  ㄴ 작성 가이드 포함<br>- 파일 업로드 영역<br>  ㄴ 드래그 앤 드롭 지원<br>  ㄴ "파일 선택" 버튼<br>  ㄴ 지원 형식: .xlsx, .xls, .csv<br>  ㄴ 최대 파일 크기: 10MB<br>  ㄴ 최대 N건 제한 (예: 100,000건)<br>- 업로드 진행 상태<br>  ㄴ 프로그레스 바 표시<br>  ㄴ 처리 중인 건수 표시<br>- 데이터 검증 결과<br>  ㄴ 전화번호 형식 검증<br>  ㄴ 중복 번호 제거<br>  ㄴ 수신거부 번호 자동 제외<br>  ㄴ 변수값 누락 확인<br>  ㄴ 유효 건수 / 전체 건수 표시<br>- 오류 내역 표시<br>  ㄴ 오류 유형별 분류<br>    → 형식 오류<br>    → 중복 제거<br>    → 수신거부<br>    → 변수 누락<br>  ㄴ 오류 번호 목록 (최대 100개)<br>  ㄴ 오류 내역 엑셀 다운로드<br>- 업로드 완료<br>  ㄴ "적용" 버튼: 검증된 수신자를 메인 페이지에 추가<br>  ㄴ "다시 업로드" 버튼: 파일 재선택<br>  ㄴ "취소" 버튼: 팝업 닫기<br>- 변수 매칭 확인<br>  ㄴ 엑셀 컬럼과 템플릿 변수 자동 매칭<br>  ㄴ 매칭 안내 메시지<br>  ㄴ 수동 매칭 옵션 제공 | KKO_REQ_003 | - 대용량 파일 처리 성능 고려<br>- 엑셀 파싱 라이브러리 필요<br>- 변수 치환 로직 구현 |
| 카톡발송 | 카톡발송 | 브랜드톡 발송 | 메시지 미리보기 | - | component | 카톡발송 > 브랜드톡 발송 > 메시지 미리보기 | KKO_2_2_4_0_0_C | 공통 | 1차 | 로그인 | **1. 메시지 미리보기 컴포넌트**<br>- 메인 페이지 우측에 고정 배치<br>- 모바일 디바이스 프레임으로 표시<br>- 실시간 업데이트<br>  ㄴ 입력값 변경 시 즉시 반영<br>  ㄴ 템플릿 선택 시 즉시 반영<br>  ㄴ 변수 입력 시 즉시 치환하여 표시<br>- 브랜드 정보 표시<br>  ㄴ 브랜드 채널 프로필 이미지<br>  ㄴ 브랜드 채널명<br>  ㄴ 발송 시간 (미리보기용 현재 시각)<br>- 메시지 유형별 렌더링<br>  ㄴ 기본형: 텍스트만 표시<br>  ㄴ 강조형: 강조 스타일 적용<br>  ㄴ 이미지형: 이미지 + 텍스트<br>  ㄴ 와이드형: 와이드 이미지 + 텍스트<br>  ㄴ 캐러셀형: 여러 카드 슬라이드<br>- 버튼 표시<br>  ㄴ 템플릿에 정의된 버튼 렌더링<br>  ㄴ 버튼 타입별 아이콘 표시<br>  ㄴ 최대 5개 버튼 표시<br>- 이미지 표시<br>  ㄴ 업로드된 이미지 미리보기<br>  ㄴ 이미지 로딩 상태 표시<br>  ㄴ 이미지 오류 시 기본 이미지 표시<br>- 변수 치환 표시<br>  ㄴ 입력된 변수값으로 치환하여 표시<br>  ㄴ 미입력 변수는 #{변수명} 형태로 표시<br>- 글자수/바이트 표시<br>  ㄴ 현재 글자수 / 최대 글자수<br>  ㄴ 바이트 수 표시<br>- 대체 메시지 미리보기<br>  ㄴ 탭 전환 형태<br>  ㄴ "브랜드톡" / "대체 메시지" 탭<br>  ㄴ SMS/LMS 형태로 표시 | KKO_REQ_005 | - 실시간 렌더링 성능 최적화<br>- 이미지 캐싱 처리<br>- 반응형 레이아웃 |

## 화면 흐름도

```
[브랜드톡 발송 페이지 진입]
        ↓
[템플릿 존재 여부 확인]
        ↓
    ┌───┴───┐
    ↓       ↓
[템플릿 있음]  [템플릿 없음]
    ↓           ↓
    ↓       [템플릿 등록 안내 표시]
    ↓           ↓
    ↓       ["템플릿 등록하러 가기" 버튼]
    ↓           ↓
    ↓       [템플릿 관리 페이지로 이동]
    ↓           ↓
    ↓       (새 탭 열림)
    ↓
[브랜드 채널 선택] → 승인 상태 확인
        ↓
[템플릿 선택] → [템플릿 선택 팝업]
        ↓              ↓
        ↓          (템플릿 없으면)
        ↓              ↓
        ↓          [등록 안내 + 이동 버튼]
        ↓
[메시지 내용 입력]
  ├─ 변수 입력 (일괄/개별)
  ├─ 이미지 업로드 (이미지형)
  └─ 버튼 링크 설정
        ↓
        ↓
[수신자 설정]
  ├─ 직접 입력
  ├─ 주소록 선택
  └─ [엑셀 업로드 팝업]
        ↓
[발송 시간 설정] → 즉시/예약 선택
        ↓
[미리보기 확인] → 브랜드톡 / 대체 메시지 확인
        ↓
[테스트 발송] (선택사항)
        ↓
[발송하기] → [발송 확인 팝업]
        ↓
[발송 처리]
  ├─ 즉시발송 → 진행률 표시
  └─ 예약발송 → 예약 등록
        ↓
[발송 완료 안내]
  ├─ 발송 결과 요약
  ├─ 발송내역 페이지로 이동
  └─ 예약내역 페이지로 이동
```

## 주요 검증 사항

### 1. 채널 및 템플릿 검증
- 브랜드 채널 등록 및 활성 상태 확인
- **템플릿 존재 여부 확인 (페이지 진입 시 최우선)**
- 템플릿 활성 상태 확인
- 템플릿과 입력값 일치성 검증
- 채널-템플릿 연결 상태 확인
- **템플릿 부재 시 발송 기능 비활성화**
- **브랜드톡은 승인 절차 없이 등록 즉시 사용 가능**

### 2. 메시지 내용 검증
- 필수 변수 입력 여부 확인
- 변수 형식 및 길이 검증
- 버튼 링크 URL 유효성 검증
- 이미지 파일 형식 및 크기 검증
- 메시지 전체 길이 제한 확인

### 3. 수신자 검증
- 전화번호 형식 검증
- 중복 번호 제거
- 수신거부 번호 자동 제외
- 수신자 수 제한 확인
- 변수 치환용 데이터 매칭 확인

### 4. 대체 메시지 검증
- 대체 메시지 내용 검증
- 대체 메시지 길이 제한 (SMS/LMS)
- 발신번호 등록 상태 확인

### 5. 비용 검증
- 잔액 확인
- 예상 비용 계산 정확성
- 충전 필요 시 안내

### 6. 발송 시간 검증
- 예약 발송 시 미래 시간 확인
- 예약 가능 기간 제한 (90일)

## 참고 사항

### 카카오 브랜드톡 규정
- 브랜드 채널(구 플러스친구) 사전 개설 필수
- **템플릿 등록 즉시 사용 가능 (승인 절차 없음)**
- 템플릿 작성 가이드라인 준수
- 정보성/광고성 메시지 모두 발송 가능
- 발송 시간 제한 없음 (24시간 발송 가능)
- 수신자 카카오톡 가입자만 수신 가능

### 템플릿 등록 프로세스
1. 브랜드 채널 개설 및 등록
2. 템플릿 관리 페이지에서 템플릿 작성
   - 템플릿 유형 선택 (기본/강조/이미지/와이드/캐러셀)
   - 메시지 내용 작성
   - 변수 설정
   - 버튼 구성
3. 템플릿 저장
4. **저장 즉시 발송 가능 (승인 절차 없음)**

### 템플릿 부재 시 사용자 안내 사항
- **명확한 상태 표시**: "템플릿이 없어 발송할 수 없습니다"
- **등록 방법 안내**: 간단한 등록 절차 및 유형별 설명
- **원클릭 이동**: "템플릿 등록하러 가기" 버튼으로 즉시 이동
- **도움말 제공**: 브랜드톡 템플릿 등록 가이드 링크
- **즉시 사용 안내**: "템플릿 등록 즉시 발송 가능" 강조
- **템플릿 유형 설명**: 각 유형의 특징과 용도 설명

### 대체 메시지 (Fallback)
- 브랜드톡 발송 실패 시 자동으로 SMS/LMS 발송
- 광고성 메시지의 경우: (광고) 문구, 080 수신거부 번호 필수
- 발송 시간 제한: 평일 08:00~21:00
- 추가 비용 발생 안내 필수

### 템플릿 유형
- **기본형**: 텍스트 메시지 (최대 1,000자)
- **강조형**: 강조 표시가 있는 텍스트 메시지
- **이미지형**: 이미지 + 텍스트 (이미지 최대 500KB)
- **와이드형**: 와이드 이미지 + 텍스트
- **캐러셀형**: 여러 카드 슬라이드 형태 (최대 10개)

### 버튼 타입
- **웹 링크**: 외부 웹페이지 연결
- **앱 링크**: 모바일 앱 실행
- **배송 조회**: 배송 조회 페이지 연결
- **봇 키워드**: 챗봇 키워드 전송
- **전화 연결**: 전화번호 연결

### 변수 치환 규칙
- 변수 형식: #{변수명}
- 변수명은 영문/한글/숫자 조합
- 최대 20개 변수 지원
- 변수값 최대 길이: 100자
- 필수/선택 변수 구분

### 기술적 고려사항
- 대량 발송 시 성능 최적화 (비동기 처리)
- 템플릿 렌더링 엔진 구현
- 변수 치환 로직 최적화
- 이미지 업로드 및 캐싱 처리
- 발송 상태 실시간 추적 시스템
- 발송 결과 통계 및 로그 저장
- 카카오 API 연동 (템플릿 조회, 발송 요청 등)
- **템플릿 존재 여부 캐싱 처리 (성능 최적화)**
- **채널 변경 시 템플릿 재확인 로직**

### 연동 페이지 및 시스템
- **브랜드 채널 관리 페이지** (마이페이지)
- **템플릿 관리 페이지** (카카오톡 템플릿 - 템플릿 부재 시 이동)
- 주소록 관리 페이지
- 수신거부 관리 페이지
- 발신번호 관리 페이지
- 발송내역 페이지
- 예약내역 페이지
- 충전하기 페이지
- 카카오 비즈니스 API
- 통신사 SMS/LMS API

### 성능 목표
- 페이지 로딩 시간: 2초 이내
- 템플릿 렌더링: 0.5초 이내
- 미리보기 업데이트: 실시간 (100ms 이내)
- 엑셀 업로드 처리: 10,000건 기준 5초 이내
- 발송 처리 속도: 초당 100건 이상

### 에러 코드 정의
- KKO_E001: 브랜드 채널 미등록
- KKO_E002: 템플릿 비활성 상태
- KKO_E003: 템플릿 내용 불일치
- KKO_E004: 필수 변수 누락
- KKO_E005: 수신자 없음
- KKO_E006: 잔액 부족
- KKO_E007: 발송 실패
- KKO_E008: 대체 메시지 발송 실패
- KKO_E009: 채널 차단/정지
- KKO_E010: 템플릿 삭제됨
- **KKO_E011: 템플릿 미등록**

### 로그 및 모니터링
- 발송 요청 로그
- 템플릿 사용 통계
- 채널별 발송 통계
- 오류 발생 로그
- 사용자 액션 로그
- 성능 모니터링 (응답 시간, 처리량)

## 개발 우선순위

### 1차 개발 (필수 기능)
- **템플릿 존재 여부 확인 및 안내**
- **템플릿 관리 페이지 이동 기능**
- 브랜드 채널 선택
- 템플릿 선택
- 메시지 내용 입력 (변수 포함)
- 수신자 설정 (직접입력, 주소록)
- 즉시발송
- 미리보기
- 발송 처리

### 2차 개발 (중요 기능)
- 엑셀 업로드 (변수 치환)
- 예약발송
- 이미지 업로드
- 테스트 발송
- 발송 상태 추적

### 3차 개발 (부가 기능)
- 캐러셀형 템플릿 지원
- 통계 및 분석
- 발송 이력 상세 조회
- 재발송 기능

## UI/UX 가이드

### 템플릿 부재 시 안내 화면
```
┌─────────────────────────────────────────┐
│                                         │
│        💬                               │
│                                         │
│   등록된 브랜드톡 템플릿이 없습니다     │
│                                         │
│   브랜드톡 발송을 위해서는 템플릿을     │
│   먼저 등록해야 합니다.                │
│                                         │
│   템플릿 유형: 기본형, 강조형,         │
│   이미지형, 와이드형, 캐러셀형         │
│                                         │
│   ✅ 템플릿 등록 즉시 사용 가능        │
│   ✅ 승인 절차 없이 바로 발송          │
│                                         │
│   ┌─────────────────────────┐          │
│   │  템플릿 등록하러 가기   │          │
│   └─────────────────────────┘          │
│                                         │
│   템플릿 등록 가이드 보기 >            │
│                                         │
└─────────────────────────────────────────┘
```

### 템플릿 선택 팝업 - 템플릿 없음 상태
```
┌─────────────────────────────────────────┐
│  템플릿 선택                       [X]  │
├─────────────────────────────────────────┤
│                                         │
│                                         │
│        📋                               │
│                                         │
│   선택한 브랜드 채널에                  │
│   등록된 템플릿이 없습니다              │
│                                         │
│   ┌───────────────────────────────┐    │
│   │  기본형  │  강조형  │  이미지형 │    │
│   │  와이드형  │  캐러셀형         │    │
│   └───────────────────────────────┘    │
│                                         │
│   템플릿을 등록하면 다양한 형태의      │
│   브랜드톡 메시지를 발송할 수 있습니다 │
│                                         │
│   ✅ 등록 즉시 사용 가능               │
│   ✅ 승인 절차 없음                    │
│                                         │
│   ┌─────────────────────────┐          │
│   │  템플릿 등록하러 가기   │          │
│   └─────────────────────────┘          │
│                                         │
│   템플릿 등록 가이드 보기 >            │
│                                         │
│                          [닫기]         │
└─────────────────────────────────────────┘
```

### 안내 메시지 톤앤매너
- **명확성**: 무엇이 필요한지 명확히 전달
- **친절함**: 사용자를 돕는 톤
- **행동 유도**: 다음 단계를 명확히 제시
- **정보 제공**: 필요한 시간, 절차, 유형 등 구체적 정보 제공
- **시각적 가이드**: 템플릿 유형별 아이콘 및 설명 제공

### 접근성 고려사항
- 버튼 및 링크의 명확한 라벨
- 충분한 색상 대비
- 키보드 네비게이션 지원
- 스크린 리더 호환성
- 명확한 오류 메시지
