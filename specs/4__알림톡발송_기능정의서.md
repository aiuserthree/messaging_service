# 알림톡 발송 기능정의서

| Role | 1Depth | 2Depth | 3Depth | 4Depth | 타입 | 화면명 | 화면 ID | PC/MO | spec | 접근 권한 | 기능 설명 | 관련 요구사항ID | 비고 |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| 카톡발송 | 카톡발송 | 알림톡 발송 | 메인 페이지 | - | page | 카톡발송 > 알림톡 발송 | KKO_1_1_0_0_0_P | 공통 | 1차 | 로그인 | **1. 페이지 진입 시 템플릿 확인**<br>- 선택한 발신 프로필의 승인 템플릿 존재 여부 자동 확인<br>- 템플릿이 없는 경우 안내 영역 표시<br>  ㄴ 안내 메시지: "등록된 알림톡 템플릿이 없습니다"<br>  ㄴ 상세 안내: "알림톡 발송을 위해서는 사전에 승인된 템플릿이 필요합니다"<br>  ㄴ 템플릿 등록 절차 간단 안내<br>  ㄴ "템플릿 등록하러 가기" 버튼<br>  ㄴ 버튼 클릭 시 템플릿 관리 페이지로 이동<br>- 템플릿이 있는 경우 정상 발송 화면 표시<br>**2. 발신 프로필 선택 영역**<br>- 드롭다운으로 발신 프로필 목록 표시<br>- 프로필별 승인 상태 표시<br>- 프로필 변경 시 해당 프로필의 템플릿 존재 여부 재확인<br>**3. 발송 설정 영역 (템플릿 있는 경우에만 활성화)**<br>- 템플릿 선택, 변수 입력, 수신번호 입력 등 모든 기능 제공 | KKO_REQ_001 | - 페이지 진입 시 템플릿 존재 여부 우선 확인<br>- 템플릿 부재 시 명확한 안내 제공 |
| 카톡발송 | 카톡발송 | 알림톡 발송 | 템플릿 선택 | - | layer popup | 카톡발송 > 알림톡 발송 > 템플릿 선택 | KKO_1_1_1_0_0_LP | 공통 | 1차 | 로그인 | **1. 템플릿 선택 레이어 팝업**<br>- "템플릿 선택" 버튼 클릭 시 레이어 팝업 호출<br>- 승인된 알림톡 템플릿 목록 조회<br>  ㄴ 선택한 발신 프로필에 등록된 템플릿만 표시<br>  ㄴ 템플릿 코드<br>  ㄴ 템플릿명<br>  ㄴ 템플릿 카테고리<br>  ㄴ 템플릿 내용 미리보기 (200자 제한)<br>  ㄴ 포함된 변수 표시<br>  ㄴ 버튼 개수<br>  ㄴ 이미지 포함 여부<br>  ㄴ 승인일자<br>  ㄴ 선택 버튼<br>- 템플릿 검색 기능<br>  ㄴ 템플릿명, 템플릿 코드로 검색<br>  ㄴ 카테고리별 필터링<br>- 템플릿 상태별 필터<br>  ㄴ 승인완료<br>  ㄴ 검수중<br>  ㄴ 반려<br>- 템플릿 상세보기<br>  ㄴ 템플릿 내용 전체 보기<br>  ㄴ 변수 목록 및 설명<br>  ㄴ 버튼 정보<br>  ㄴ 이미지 미리보기<br>- 템플릿 선택 시<br>  ㄴ 선택한 템플릿 정보가 발송 페이지에 자동 반영<br>  ㄴ 변수 입력 필드 자동 생성<br>  ㄴ 팝업 자동 닫기<br>**- 템플릿 등록 안내 (템플릿이 없는 경우)**<br>  ㄴ 팝업 중앙에 안내 영역 표시<br>  ㄴ 아이콘 + 메시지: "등록된 알림톡 템플릿이 없습니다"<br>  ㄴ 상세 안내 텍스트:<br>    → "알림톡 발송을 위해서는 카카오톡 채널에서"<br>    → "템플릿을 등록하고 승인받아야 합니다"<br>    → "템플릿 등록 후 1~2 영업일 내 승인됩니다"<br>  ㄴ "템플릿 등록하러 가기" 버튼 (Primary 스타일)<br>    → 클릭 시 템플릿 관리 페이지로 이동 (새 탭)<br>    → URL: /kakao/template/alimtalk<br>  ㄴ "템플릿 등록 가이드 보기" 링크<br>    → 클릭 시 템플릿 등록 가이드 페이지 열림<br>  ㄴ "닫기" 버튼<br>- 닫기 버튼: 팝업 닫기 | KKO_REQ_002 | - 카카오톡 템플릿 관리 페이지와 연동<br>- 승인 완료된 템플릿만 발송 가능<br>- 템플릿 부재 시 등록 유도 |
| 카톡발송 | 카톡발송 | 알림톡 발송 | 엑셀 업로드 | - | layer popup | 카톡발송 > 알림톡 발송 > 엑셀 업로드 | KKO_1_1_2_0_0_LP | 공통 | 1차 | 로그인 | **1. 엑셀 업로드 레이어 팝업**<br>- "엑셀 업로드" 버튼 클릭 시 레이어 팝업 호출<br>- 엑셀 샘플 다운로드<br>  ㄴ "샘플 다운로드" 버튼<br>  ㄴ 샘플 파일 형식: 전화번호, 이름, 변수1, 변수2... 컬럼<br>  ㄴ 템플릿에 포함된 변수에 따라 컬럼 구성<br>  ㄴ 변수 입력 가이드 포함<br>- 파일 업로드 영역<br>  ㄴ 드래그 앤 드롭 지원<br>  ㄴ 파일 선택 버튼<br>  ㄴ 지원 형식: .xlsx, .xls, .csv<br>  ㄴ 최대 파일 크기: 10MB<br>  ㄴ 최대 N건 제한<br>- 업로드 후 데이터 검증<br>  ㄴ 필수 컬럼 확인 (전화번호, 필수 변수)<br>  ㄴ 전화번호 형식 검증<br>  ㄴ 변수 값 형식 검증<br>  ㄴ 중복 번호 제거<br>  ㄴ 유효한 번호 개수 표시<br>  ㄴ 오류 데이터 목록 표시 (최대 100개)<br>  ㄴ 오류 사유: 전화번호 형식 오류, 필수 변수 누락, 변수 형식 오류<br>- 데이터 미리보기<br>  ㄴ 업로드된 데이터 샘플 표시 (최대 10건)<br>  ㄴ 컬럼별 데이터 확인<br>- 업로드 완료<br>  ㄴ "적용" 버튼 클릭 시 수신번호 및 변수 값 자동 매핑<br>  ㄴ 팝업 닫기<br>- 오류 처리<br>  ㄴ 파일 형식 오류<br>  ㄴ 파일 크기 초과<br>  ㄴ 데이터 형식 오류<br>  ㄴ 재업로드 안내 | KKO_REQ_003 | - 엑셀 파일 파싱 기능<br>- 대량 번호 및 변수 처리 성능 고려<br>- 변수별 데이터 매핑 기능 |

## 화면 흐름도

```
[알림톡 발송 페이지 진입]
        ↓
[템플릿 존재 여부 확인]
        ↓
    ┌───┴───┐
    ↓       ↓
[템플릿 있음]  [템플릿 없음]
    ↓           ↓
    ↓       [템플릿 등록 안내 표시]
    ↓           ↓
    ↓       ["템플릿 등록하러 가기" 버튼]
    ↓           ↓
    ↓       [템플릿 관리 페이지로 이동]
    ↓           ↓
    ↓       (새 탭 열림)
    ↓
[발신 프로필 선택] → 프로필 승인 상태 확인
        ↓
[템플릿 선택] → [템플릿 선택 팝업]
        ↓              ↓
        ↓          (템플릿 없으면)
        ↓              ↓
        ↓          [등록 안내 + 이동 버튼]
        ↓
[변수 입력] → 필수 변수 확인
        ↓
[수신번호 입력] → 직접입력/주소록/엑셀업로드
        ↓                    ↓
   (선택사항)
        ↓
[발송시간 설정] → 즉시/예약
        ↓
        ↓
[테스트 발송] (선택사항)
        ↓
[발송하기] → [발송 확인 팝업] → 발송 정보 최종 확인
        ↓
[발송 처리] → 발송 상태 실시간 표시
        ↓
[발송완료 안내] → 발송내역/예약내역 페이지로 이동
```

## 주요 검증 사항

### 1. 카카오톡 채널 및 템플릿 검증
- 발신 프로필 등록 및 승인 상태 확인
- **템플릿 존재 여부 확인 (페이지 진입 시 최우선)**
- 템플릿 승인 상태 확인
- 템플릿 내용 수정 불가 확인
- 선택한 프로필과 템플릿 매칭 확인
- **템플릿 부재 시 발송 기능 비활성화**

### 2. 변수 검증
- 필수 변수 입력 확인
- 변수 형식 검증 (숫자, 날짜, 텍스트 등)
- 변수 값 길이 제한 확인
- 엑셀 업로드 시 변수 매핑 정확성 확인

### 3. 수신번호 검증
- 전화번호 형식 검증
- 중복 번호 제거
- 카카오톡 가입 여부 확인
- 수신 차단 사용자 확인

### 4. 대체 메시지 검증
- 대체 메시지 내용 필수 확인
- 변수 매핑 정확성 확인

### 5. 비용 검증
- 잔액 확인
- 충전 필요 시 안내

### 6. 사용자 경험
- **템플릿 부재 시 명확한 안내 및 등록 유도**
- 실시간 미리보기 (알림톡 형태)
- 변수 입력 가이드 제공
- 템플릿 기반 자동 생성 기능
- 테스트 발송 기능
- 명확한 오류 메시지
- 발송 상태 실시간 추적

## 참고 사항

### 카카오톡 알림톡 규정
- 카카오톡 채널(구 플러스친구) 사전 등록 필수
- 템플릿 사전 검수 및 승인 필수
- 템플릿 내용 수정 불가 (승인된 내용 그대로 사용)
- 변수 치환 기능 활용
- 정보성 메시지만 발송 가능
- 광고성 메시지는 브랜드톡 사용
- 발송 시간 제한 없음 (24시간 발송 가능)

### 템플릿 등록 프로세스
1. 카카오톡 채널 개설 및 등록
2. 템플릿 관리 페이지에서 템플릿 작성
3. 템플릿 검수 요청
4. 카카오 검수 진행 (1~2 영업일)
5. 승인 완료 후 알림톡 발송 가능

### 템플릿 부재 시 사용자 안내 사항
- **명확한 상태 표시**: "템플릿이 없어 발송할 수 없습니다"
- **등록 방법 안내**: 간단한 등록 절차 설명
- **원클릭 이동**: "템플릿 등록하러 가기" 버튼으로 즉시 이동
- **도움말 제공**: 템플릿 등록 가이드 링크
- **예상 소요 시간**: "템플릿 승인까지 1~2 영업일 소요" 안내

### 기술적 고려사항
- 대량 발송 시 성능 최적화
- 변수 치환 처리 로직
- 카카오톡 API 연동
- 발송 상태 실시간 추적 시스템
- 통계 및 로그 저장
- 엑셀 데이터 파싱 및 검증
- **템플릿 존재 여부 캐싱 처리 (성능 최적화)**
- **프로필 변경 시 템플릿 재확인 로직**

### 대체 메시지 설정
- 알림톡 발송 실패 시 자동으로 SMS/LMS로 전환
- 변수 데이터 공유 및 매핑

### 연동 페이지
- **카카오톡 템플릿 관리 페이지** (템플릿 부재 시 이동)
- 발신 프로필 관리 페이지
- 주소록 관리 페이지
- 발송내역 페이지
- 예약내역 페이지
- 충전하기 페이지

### 알림톡 vs 광고문자 차이점
| 구분 | 알림톡 | 광고문자 |
|---|---|---|
| 플랫폼 | 카카오톡 | SMS/LMS/MMS |
| 사전 승인 | 템플릿 승인 필요 | 불필요 |
| 내용 수정 | 불가 (변수만 치환) | 자유롭게 작성 |
| 발송 시간 | 24시간 가능 | 평일 08:00~21:00 |
| 광고성 문구 | 불필요 | (광고) 필수 |
| 수신거부 | 카카오톡 내 차단 | 080 번호 필수 |
| 용도 | 정보성 메시지 | 광고성 메시지 |
| 비용 | 건당 N원 | SMS/LMS/MMS 별도 |

## 개발 우선순위

### 1차 개발 (필수 기능)
- **템플릿 존재 여부 확인 및 안내**
- **템플릿 관리 페이지 이동 기능**
- 발신 프로필 선택
- 템플릿 선택 및 변수 입력
- 수신번호 입력 (직접입력, 주소록)
- 즉시발송
- 발송 비용 계산
- 미리보기
- 발송 처리

### 2차 개발 (중요 기능)
- 엑셀 업로드 (변수 포함)
- 예약발송
- 테스트 발송
- 발송 상태 추적

### 3차 개발 (부가 기능)
- 통계 및 분석
- 발송 이력 조회
- 재발송 기능

## UI/UX 가이드

### 템플릿 부재 시 안내 화면
```
┌─────────────────────────────────────────┐
│                                         │
│        📋                               │
│                                         │
│   등록된 알림톡 템플릿이 없습니다       │
│                                         │
│   알림톡 발송을 위해서는 카카오톡       │
│   채널에서 템플릿을 등록하고           │
│   승인받아야 합니다.                   │
│                                         │
│   템플릿 등록 후 1~2 영업일 내          │
│   승인됩니다.                          │
│                                         │
│   ┌─────────────────────────┐          │
│   │  템플릿 등록하러 가기   │          │
│   └─────────────────────────┘          │
│                                         │
│   템플릿 등록 가이드 보기 >            │
│                                         │
└─────────────────────────────────────────┘
```

### 안내 메시지 톤앤매너
- **명확성**: 무엇이 필요한지 명확히 전달
- **친절함**: 사용자를 돕는 톤
- **행동 유도**: 다음 단계를 명확히 제시
- **정보 제공**: 필요한 시간, 절차 등 구체적 정보 제공
